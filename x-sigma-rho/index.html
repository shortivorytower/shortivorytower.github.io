<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>X Sigma Rho Risk Decomposition - Short Ivory Tower</title>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-P3RGW6V');</script>
<!-- End Google Tag Manager -->


  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="Short Ivory Tower" property="og:site_name">
  
    <meta content="X Sigma Rho Risk Decomposition" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="This blog is a place for me to write down technical stuff that I found interesting. 
" property="og:description">
  
  
    <meta content="/x-sigma-rho/" property="og:url">
  
  
    <meta content="2019-04-15T00:00:00+08:00" property="article:published_time">
    <meta content="/about/" property="article:author">
  
  
    <meta content="/assets/img/hk-add-oil.jpg" property="og:image">
  
  
    
  
  
    
    <meta content="Statistics" property="article:tag">
    
    <meta content="Finance" property="article:tag">
    
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">
  
    <meta name="twitter:title" content="X Sigma Rho Risk Decomposition">
  
  
    <meta name="twitter:url" content="/x-sigma-rho/">
  
  
    <meta name="twitter:description" content="This blog is a place for me to write down technical stuff that I found interesting. 
">
  
  
    <meta name="twitter:image:src" content="/assets/img/hk-add-oil.jpg">
  

	<meta name="description" content="">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicon/apple-touch-icon-144x144.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css">
</head>

<body>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P3RGW6V"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->


  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="cover-author-image">
        <a href="/"><img src="/assets/img/hk-add-oil.jpg" alt="Short Ivory Tower"></a>
      </div>
      <div class="author-name">Short Ivory Tower</div>
      <p>This blog is a notepad to write down technical stuff that I found interesting.</p>
    </div>
  </header> <!-- End Header -->
  <footer>
    <section class="contact">
      <h3 class="contact-title">Contact me</h3>
      <ul>
        
	<!--
          <li><a href="https://twitter.com/artemsheludko_" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
	-->
        
        
	<!--
          <li><a href="https://facebook.com/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
	-->
        
        
          <li class="github"><a href="http://github.com/shortivorytower" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
	<!--
          <li class="linkedin"><a href="https://in.linkedin.com/" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
	-->
        
        
	<!--
          <li class="email"><a href="mailto:example.david@blog.com"><i class="fa fa-envelope-o" aria-hidden="true"></i></a></li>
	-->
        
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2020 &copy; Short Ivory Tower</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    
    
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">X Sigma Rho Risk Decomposition</h1>
        <div class="page-date"><span>2019, Apr 15&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
      </header>
      <script type="text/x-mathjax-config">
MathJax.Hub.Config({
                  tex2jax: {
                    inlineMath: [['$','$'], ['\\(','\\)']], 
                    displayMath: [ ['$$','$$'], ['\[','\]'] ],
                    processEnvironments: true
                  }
                });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!--
  >
-->

<p>Traditionally in finance the word “risk” means the standard deviation of a portfolio return, which usually consists of risky assets (i.e. equity positions) that “classically” assumed normally distributed returns.</p>

<h3 id="multi-factor-model-and-portfolio-variance">Multi-Factor Model and Portfolio Variance</h3>

<p>Given a portfolio <script type="math/tex">p</script> (which contains multiple stocks), the portfolio return <script type="math/tex">R_p</script> is given by its portfolio alpha <script type="math/tex">\alpha_p</script>, <script type="math/tex">n</script> common factors exposure <script type="math/tex">x_i</script> times the common factors return <script type="math/tex">R_i</script>, plus the unexplained randomness/idiosyncratic return <script type="math/tex">\epsilon_p</script> that is assumed to be uncorrelated with the common factor returns.</p>

<script type="math/tex; mode=display">R_p = \alpha_p + x_1 R_1 + x_2 R_2 + \dots + x_n R_n + \epsilon_p</script>

<p>And when we look into the variance of the portfolio return  <script type="math/tex">Var(R_p)</script>, this basic statistics formula gives this traditional breakdown.</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}

Var(R_p) & = \sum_{i=1}^{n} x_i^2 Var(R_i) + 2 \sum_{i \neq j} x_i x_j Cov(R_i, R_j) + Var(\epsilon_p) \\
&= \sum_{i=1}^{n} \sum_{j=1}^{n} x_i x_j Cov(R_i, R_j) + Var(\epsilon_p)

\tag{1}

\end{align*} %]]></script>

<p>Obviously the portfolio risk <script type="math/tex">\sigma_p</script> is</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
\sigma_p & = \sqrt{ \sum_{i=1}^{n} x_i^2 Var(R_i) + 2 \sum_{i \neq j} x_i x_j Cov(R_i, R_j) + Var(\epsilon_p) } \\
& = \sqrt{ \sum_{i=1}^{n} \sum_{j=1}^{n} x_i x_j Cov(R_i, R_j) + Var(\epsilon_p) }
\end{align*} %]]></script>

<p>It is actually difficult to interpret how those common factors risk contributed to the portfolio risk due to the square root. Even if we just look at the variance instead it is still not intuitive to attribute the risk because of the covariance between the common factors return.</p>

<p>There is an interesting risk decomposition method called <strong>X-Sigma-Rho Decomposition</strong> that was <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.170.7503&amp;rep=rep1&amp;type=pdf">published</a> by Davis and Menchero in 2010. This method can break down the portfolio risk <script type="math/tex">\sigma_p</script> into a linear sum of individual common factors contribution terms and individual asset specific contribution terms.</p>

<h3 id="portfolio-variance-in-matrix-form">Portfolio Variance in Matrix Form</h3>

<p>Assuming that we have <script type="math/tex">k</script> stocks in our portfolio, and have <script type="math/tex">n</script> common factors in our model. The portfolio variance in <script type="math/tex">(1)</script> can be rewritten in the following matrix form,</p>

<script type="math/tex; mode=display">\begin{align*}

Var(R_p) = \sigma_p^2 = \mathbf{w}^T (\mathbf{F} \mathbf{C} \mathbf{F}^T + \mathbf{Q}) \mathbf{w}

\tag{2}

\end{align*}</script>

<p><script type="math/tex">\mathbf{w}</script> is the vector that contains the weight (summing up to 1) of the stock positions. For example if we have two stocks in our portfolio, <script type="math/tex">\mathbf{w}</script> maybe equal to</p>

<script type="math/tex; mode=display">\begin{pmatrix} 0.7 \\  0.3 \end{pmatrix}</script>

<p>representing we have 70% of the market value invested in the first stock and 30% invested in the second stock. In general we have <script type="math/tex">k</script> stocks then</p>

<script type="math/tex; mode=display">\mathbf{w} =
\begin{pmatrix}
w_1 \\
w_2 \\
\vdots \\
w_{k-1} \\
w_k
\end{pmatrix}</script>

<p><script type="math/tex">\mathbf{F}</script> is the factor exposure matrix. Each row consists of the factors exposure of each stock. For example if we have three factors in the model and have two stocks in our portfolio, <script type="math/tex">\mathbf{F}</script> maybe equal to</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{pmatrix}
2.5 & 0.3 & -0.2 \\
-1 & 0.25 & 0.2 \\
\end{pmatrix} %]]></script>

<p>representing that the first stock has exposure of 2.5, 0.3, -0.2 on factor 1,2 and 3 respectively, and the second stock has exposure of -1, 0.25, 0.2 exposure on factor 1,2, and 3. In general if we have <script type="math/tex">k</script> stocks and <script type="math/tex">n</script> factors then</p>

<script type="math/tex; mode=display">% <![CDATA[
\mathbf{F} =
\begin{pmatrix}
f_{11} & f_{12} & \cdots & f_{1n} \\
f_{21} & f_{22} & \cdots & f_{2n} \\
\vdots & \vdots & \vdots & \vdots \\
\vdots & \vdots & \vdots & \vdots \\
f_{k1} & f_{k2} & \cdots & f_{kn} \\

\end{pmatrix} %]]></script>

<p><script type="math/tex">\mathbf{C}</script> is the factors covariance matrix. It describes the covariance of the common factor returns. For example if we have three factors, <script type="math/tex">\mathbf{C}</script> may look like this</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{pmatrix}
0.04 & 0.006 & 0.006 \\
0.006  & 0.01 & 0.0075 \\
0.006 & 0.0075 & 0.09 \\
\end{pmatrix} %]]></script>

<p>representing <script type="math/tex">Cov(R_1, R_1)</script> = 0.04, <script type="math/tex">Cov(R_1, R_2)</script> = 0.006, <script type="math/tex">Cov(R_1, R_3)</script> = 0.006 and so on. In general if we have <script type="math/tex">n</script> common factors,</p>

<script type="math/tex; mode=display">% <![CDATA[
\mathbf{C} = 
\begin{pmatrix}
Cov(R_1, R_1) & Cov(R_1, R_2) & \cdots & Cov(R_1,R_n) \\
Cov(R_2, R_1) & Cov(R_2, R_2) & \cdots & Cov(R_2,R_n) \\
\vdots & \vdots & \vdots & \vdots \\
Cov(R_n, R_1) & Cov(R_n, R_2) & \cdots & Cov(R_n,R_n) \\
\end{pmatrix} %]]></script>

<p><script type="math/tex">\mathbf{Q}</script> is the specific return variance matrix. Since all specific return are independent the matrix only has diagonal value representing the the return variance of each stock in the portfolio. For example if we have two stocks in the portfolio <script type="math/tex">\mathbf{Q}</script> may look like</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{pmatrix}
0.09 & 0 \\
0 & 0.0625 \\
\end{pmatrix} %]]></script>

<p>representing the first stock has a risk (return standard deviation) of 30% and the second stock has a risk of 25% so the variance are 0.09 and 0.0625 respectively. In general if we have <script type="math/tex">k</script> stocks</p>

<script type="math/tex; mode=display">% <![CDATA[
\mathbf{Q} =
\begin{pmatrix}
Var(\epsilon_1) & 0 & \cdots & 0 \\
0 & Var(\epsilon_2) & \cdots & 0 \\
\vdots & \vdots & \vdots & \vdots \\
0 & 0 & \cdots & Var(\epsilon_k) 
\end{pmatrix} %]]></script>

<p>and here we can see that <script type="math/tex">\mathbf{w}^T \mathbf{Q} \mathbf{w} = \sum_{i=1}^{k} w_i^2 Var(\epsilon_i)</script> which is equal to the <script type="math/tex">Var(\epsilon_p)</script> term in formula <script type="math/tex">(1)</script> above.</p>

<p>Now let <script type="math/tex">\mathbf{x} = \mathbf{F}^T \mathbf{w}</script> as the portfolio factors exposure, formula <script type="math/tex">(2)</script> becomes</p>

<script type="math/tex; mode=display">Var(R_p) = \mathbf{x}^T \mathbf{C} \mathbf{x} + \mathbf{w}^T \mathbf{Q} \mathbf{w}
\tag{3}</script>

<p>Obviously <script type="math/tex">\mathbf{x}</script> is portfolio factors exposure vector that
<script type="math/tex">\mathbf{x} =
\begin{pmatrix}
x_1 \\
x_2 \\
\vdots \\
x_n \\
\end{pmatrix}</script></p>

<p>and <script type="math/tex">x_i = \sum_{h=1}^{k} w_h f_{hi}</script> which is equal to the corresponding <script type="math/tex">x_i</script> value in formula <script type="math/tex">(1)</script> above.</p>

<h3 id="x-sigma-rho-decomposition">X Sigma Rho Decomposition</h3>

<p>First if we look into this particular matrix multiplication <script type="math/tex">\mathbf{C} \mathbf{x}</script> in formula <script type="math/tex">(3)</script>.</p>

<script type="math/tex; mode=display">\mathbf{C} \mathbf{x}  =
\begin{pmatrix}
\sum_{i=1}^{n} x_i Cov(R_1, R_i) \\
\sum_{i=1}^{n} x_i Cov(R_2, R_i) \\
\vdots \\
\sum_{i=1}^{n} x_i Cov(R_{n-1}, R_i) \\
\sum_{i=1}^{n} x_i Cov(R_{n}, R_i) \\
\end{pmatrix}</script>

<p>Now for any <script type="math/tex">j = 1,2,\dots, n</script>,</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
Cov(R_j, R_p) 
&= Cov(R_j, x_1 R_1 + x_2 R_2 + \dots + x_n R_n + \epsilon_p) \\ 
&= x_1 Cov(R_j, R_1) + x_2 Cov(R_j, R_2) + \dots + x_n Cov(R_j, R_n) \\
&= \sum_{i=1}^{n} x_i Cov(R_j, R_i) \\
\end{align*} %]]></script>

<p>Put it back into <script type="math/tex">\mathbf{C} \mathbf{x}</script>,</p>

<script type="math/tex; mode=display">\mathbf{C} \mathbf{x}  =
\begin{pmatrix}
Cov(R_1, R_p) \\
Cov(R_2, R_p) \\
\vdots \\
Cov(R_{n-1}, R_p) \\
Cov(R_n, R_p) \\
\end{pmatrix} \\</script>

<p>Then we can have the common factor marginal contributions to risk,</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
\mathbf{c_f} & = \frac{\mathbf{C} \mathbf{x}}{\sigma_p} \\

& =

\begin{pmatrix}
\frac{Cov(R_1, R_p)}{\sigma_p} \\
\frac{Cov(R_2, R_p)}{\sigma_p} \\
\vdots \\
\frac{Cov(R_{n-1}, R_p)}{\sigma_p} \\
\frac{Cov(R_n, R_p)}{\sigma_p} \\
\end{pmatrix} \\

\tag{4}
\end{align*} %]]></script>

<p>Similar we consider the multiplication term <script type="math/tex">\mathbf{Q}\mathbf{w}</script> in formula <script type="math/tex">(3)</script>.</p>

<script type="math/tex; mode=display">\mathbf{Q} \mathbf{w}  =
\begin{pmatrix}

w_1 Var(\epsilon_1) \\
w_2 Var(\epsilon_2) \\
\vdots \\
w_{k-1} Var(\epsilon_{k-1}) \\
w_k Var(\epsilon_k) \\

\end{pmatrix}</script>

<p>Once again we consider for any <script type="math/tex">j = 1,2,\dots, k</script>,</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}

Cov(\epsilon_j, R_p) 
&= Cov(\epsilon_j, x_1 R_1 + x_2 R_2 + \dots + x_n R_n + \epsilon_p) \\
&= Cov(\epsilon_j, \epsilon_p) \\
&= Cov(\epsilon_j, w_1 \epsilon_1 + w_2 \epsilon_2 + \dots + w_k \epsilon_k) \\
&= Cov(\epsilon_j, w_j \epsilon_j) \\
&= w_j Var(\epsilon_j) \\

\end{align*} %]]></script>

<p>Put it back to <script type="math/tex">\mathbf{Q} \mathbf{w}</script>,</p>

<script type="math/tex; mode=display">\mathbf{Q} \mathbf{w}  =
\begin{pmatrix}

Cov(\epsilon_1, R_p) \\
Cov(\epsilon_2, R_p) \\
\vdots \\
Cov(\epsilon_{k-1}, R_p) \\
Cov(\epsilon_k, R_p) \\

\end{pmatrix} \\</script>

<p>And now we can have the asset specific marginal contribution to risk,</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
\mathbf{c_q} & = \frac{\mathbf{Q} \mathbf{w}}{\sigma_p} \\

& =

\begin{pmatrix}

\frac{Cov(\epsilon_1, R_p)}{\sigma_p} \\
\frac{Cov(\epsilon_2, R_p)}{\sigma_p} \\
\vdots \\
\frac{Cov(\epsilon_{k-1}, R_p)}{\sigma_p} \\
\frac{Cov(\epsilon_k, R_p)}{\sigma_p} \\

\end{pmatrix} \\

\tag{5}

\end{align*} %]]></script>

<p>The next step we put together the equations <script type="math/tex">(3)(4)(5)</script>,</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}

Var(R_p) &= \mathbf{x}^T \mathbf{C} \mathbf{x} + \mathbf{w}^T \mathbf{Q} \mathbf{w} \\

\sigma_p &= \mathbf{x}^T \frac{\mathbf{C} \mathbf{x}}{\sigma_p} + \mathbf{w}^T \frac{\mathbf{Q} \mathbf{w}}{\sigma_p} \\

&= \mathbf{x}^T \mathbf{c_f} + \mathbf{w}^T \mathbf{c_q}  \tag{6} \\

\end{align*} %]]></script>

<p>Rewrite the portfolio risk <script type="math/tex">\sigma_p</script> above as summation terms,</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}

\sigma_p &= \sum_{i=1}^{n} x_i \frac{Cov(R_i,R_p)}{\sigma_p} + \sum_{j=1}^{k} w_j \frac{Cov(\epsilon_j, R_p)}{\sigma_p} \\

\end{align*}

\tag{7} %]]></script>

<p>For <script type="math/tex">i = 1 \dots n</script> and <script type="math/tex">j = 1 \dots k</script>, let</p>

<ul>
  <li><script type="math/tex">\sigma_i = \sqrt{Var(R_i)}</script> as the standard deviation of the <script type="math/tex">i^{th}</script> common factor return,</li>
  <li><script type="math/tex">\sigma_j = \sqrt{Var(\epsilon_j)}</script> as the standard deviation of the <script type="math/tex">j^{th}</script> asset specific return.</li>
  <li><script type="math/tex">\rho(R_i, R_p)</script> as the correlation between <script type="math/tex">i^{th}</script> common factor return and the portfolio return,</li>
  <li>and <script type="math/tex">\rho(\epsilon_j, R_p)</script> as the correlation between <script type="math/tex">j^{th}</script> asset specific return and the portfolio return.</li>
</ul>

<p>Putting <script type="math/tex">\sigma_i</script> and <script type="math/tex">\sigma_j</script> into formula <script type="math/tex">(7)</script>, we get the X Sigma Rho decomposition formula.</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}

\sigma_p &= \sum_{i=1}^{n} x_i \frac{Cov(R_i,R_p)}{\sigma_p} + \sum_{j=1}^{k} w_j \frac{Cov(\epsilon_j, R_p)}{\sigma_p} \\

&= \sum_{i=1}^{n} x_i \sigma_i \frac{Cov(R_i,R_p)}{\sigma_i \sigma_p} + \sum_{j=1}^{k} w_j \sigma_j \frac{Cov(\epsilon_j, R_p)}{\sigma_j \sigma_p} \\

&= \sum_{i=1}^{n} x_i \sigma_i \rho(R_i, R_p) + \sum_{j=1}^{k} w_j \sigma_j \rho(\epsilon_j, R_p)   \tag{8} \\

\end{align*} %]]></script>

<p>Comparing equation <script type="math/tex">(6)</script> and <script type="math/tex">(8)</script>, the portfolio risk can be decomposed into two major parts.</p>

<script type="math/tex; mode=display">\sigma_p = \sigma_f + \sigma_q</script>

<p>The common factor contribution,</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
\sigma_f &= \mathbf{x}^T \mathbf{c_f} \\
&= \sum_{i=1}^{n} x_i \sigma_i \rho(R_i, R_p)    \tag{9}
\end{align*} %]]></script>

<p>And the asset specific contribution,
<script type="math/tex">% <![CDATA[
\begin{align*}
\sigma_q &= \mathbf{w}^T \mathbf{c_q} \\
&= \sum_{j=1}^{k} w_j \sigma_j \rho(\epsilon_j, R_p)    \tag{10}
\end{align*} %]]></script></p>

<p>And for each part of the contribution terms it can then be further broken down into each common factor contribution and each asset specific contribution.</p>

<h3 id="implementation">Implementation</h3>

<p>To illustrate how it works, I have put together a simple implementation of a portfolio with two stocks namely</p>

<ul>
  <li>0005.HK - HSBC. A major global financial institute listed in Hong Kong Stock Exchange. &lt;/li&gt;</li>
  <li>2899.HK - Zijin Mining Group Co Ltd. A China mining business listed in Hong Kong Stock Exchange.</li>
</ul>

<p>I have also selected three factors just purely due to the reason of easy data download, while still try to make a bit of financial modeling sense.</p>

<ul>
  <li>HSI Index - The market index of Hong Kong stock market.</li>
  <li>SSE Composite Index (000001.SS) - A representative market index for China stocks.</li>
  <li>XAU - The spot gold price. Hopefully there would be some impact related to mining related business.</li>
</ul>

<p>I have only collected roughly a month of daily closing price from Yahoo. Obviously we would need lot more data points to have a reasonably accurate estimates on the exposures and standard deviations, but here I don’t mind since that’s just my trial implementation not for any real production use.</p>

<p>First we define a model class which contains all key parameters estimation we would need for X Sigma Rho Decomposition</p>

<ul>
  <li>Each factor exposures on each individual stock</li>
  <li>Each stock specific annualized risk</li>
  <li>Each factor annualized risk</li>
  <li>The correlations of the factor returns</li>
</ul>

<noscript><pre>400: Invalid request</pre></noscript>
<script src="https://gist.github.com/e80be981510bcefbfa2df8554f53e1f6.js"> </script>

<p>Then we implement a function that reads the raw data from CSV files, and use simple linear regression to estimate those factor loadings/risks/correlations.</p>

<noscript><pre>400: Invalid request</pre></noscript>
<script src="https://gist.github.com/b8c8d7f750b540937d198a972ceeae56.js"> </script>

<p>The result of the function above is the FactorModel object which will then be used to compute the portfolio total risk, and the X Sigma Rho decomposition in the next function.</p>

<noscript><pre>400: Invalid request</pre></noscript>
<script src="https://gist.github.com/dbb41143e190c694c909a048a92b1b66.js"> </script>

<p>Let’s say we have 70% of our capital put on HSBC Stock (0005.HK) and 30% on Zijin Mining (2899.HK). Running these pieces of code altogether along with the data collected, it outputs the following analysis:</p>

<noscript><pre>400: Invalid request</pre></noscript>
<script src="https://gist.github.com/fb9ef1cc737833ebca87e7ef556042eb.js"> </script>

<p>Here I am not doing any serious linear regression. I didn’t test the significance of the coefficients. All I want to do is just get whatever factor loadings in order to try the X-Sigma-Rho decomposition.</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}

R_{hsbc} &= 0.07\% + 0.5785 R_{hsi} -0.0071 R_{sse} - 0.0127 R_{xau} + N(0, 0.064432) \\
R_{zijin} &= -0.04\% + 0.5996 R_{hsi} + 0.4976 R_{sse} + 0.1589 R_{xau} + N(0, 0.288719) \\

\end{align*} %]]></script>

<p>Our test portfolio has 70% on HSBC and 30% on Zijin Mining, which ends up we have 15.2881% total portfolio risk. (i.e. <script type="math/tex">\sigma_p</script>).</p>

<p>And out of these 15.2881%, we have common factor contribution (i.e. <script type="math/tex">\sigma_f</script>) 9.0502% and asset specific contribution (i.e. <script type="math/tex">\sigma_q</script>) 6.2379%.</p>

<p>The X Sigma Rho Decomposition:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}

\sigma_p &= 15.2881\% \\
&= \sigma_f + \sigma_q = 9.0502\% + 6.2379\% \\
&= \bigg[ x_{hsi} \sigma_{hsi} \rho(R_{hsi}, R_p) + x_{sse} \sigma_{sse} \rho(R_{sse}, R_p) + x_{xau} \sigma_{xau} \rho(R_{xau}, R_p) \bigg] + \bigg[ w_{hsbc} \sigma_{hsbc} \rho(\epsilon_{hsbc}, R_p) + w_{zijin} \sigma_{zijin} \rho(\epsilon_{zijin}, R_p) \bigg]  \\

&= \bigg[ 6.7473\% + 2.6424\% -0.3395\% \bigg] + \bigg[ 1.3306\% + 4.9073\% \bigg] \\

\end{align*} %]]></script>

<p><a href="https://github.com/shortivorytower/blog_sources/tree/master/python/x_sigma_rho">Source Code</a></p>


      <div class="page-footer">
        <div class="page-share">
          <a href="https://twitter.com/intent/tweet?text=X Sigma Rho Risk Decomposition&url=/x-sigma-rho/" title="Share on Twitter" rel="nofollow" target="_blank">Twitter</a>
          <a href="https://facebook.com/sharer.php?u=/x-sigma-rho/" title="Share on Facebook" rel="nofollow" target="_blank">Facebook</a>
          <a href="https://plus.google.com/share?url=/x-sigma-rho/" title="Share on Google+" rel="nofollow" target="_blank">Google+</a>
        </div>
        <div class="page-tag">
          
            <a href="/tags#Statistics" class="tag">&#35; Statistics</a>
          
            <a href="/tags#Finance" class="tag">&#35; Finance</a>
          
        </div>
      </div>
      <section class="comment-area">
  <div class="comment-wrapper">
    
    <div id="disqus_thread" class="article-comments"></div>
    <script>
      (function() {
          var d = document, s = d.createElement('script');
          s.src = '//shortivorytower.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
  </div>
</section> <!-- End Comment Area -->

    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->
</article> <!-- End Article Page -->

</div>

  </div>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

</body>
</html>
